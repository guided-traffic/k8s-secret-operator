# Combined Secret Generation and Replication Example
#
# This example shows how to combine secret generation with replication.
# The operator supports two valid combinations:
#
# 1. ✅ autogenerate + replicatable-from-namespaces (allowed)
#    - Generate secrets in one namespace, allow others to pull
#
# 2. ❌ autogenerate + replicate-from (NOT allowed)
#    - Conflicting features - will be rejected with Warning Event

---
# Valid combination: Generate and allow replication
# Use case: Generate secrets in production, share with staging/dev
apiVersion: v1
kind: Secret
metadata:
  name: api-credentials
  namespace: production
  annotations:
    # Generate API key and secret automatically
    iso.gtrfc.com/autogenerate: "api-key,api-secret"
    iso.gtrfc.com/length: "32"
    iso.gtrfc.com/string.specialChars: "true"

    # Allow staging and development to pull these credentials
    iso.gtrfc.com/replicatable-from-namespaces: "staging,development"
type: Opaque
data:
  # api-key and api-secret will be auto-generated
  service-name: bXktYXBp  # my-api

---
# Target Secrets pulling from the generated source
apiVersion: v1
kind: Secret
metadata:
  name: api-credentials
  namespace: staging
  annotations:
    iso.gtrfc.com/replicate-from: "production/api-credentials"
type: Opaque

---
apiVersion: v1
kind: Secret
metadata:
  name: api-credentials
  namespace: development
  annotations:
    iso.gtrfc.com/replicate-from: "production/api-credentials"
type: Opaque

---
# Valid combination: Generate and push
# Use case: Generate secrets and automatically distribute
apiVersion: v1
kind: Secret
metadata:
  name: encryption-keys
  namespace: security
  annotations:
    # Generate encryption keys
    iso.gtrfc.com/autogenerate: "master-key,data-key"
    iso.gtrfc.com/type: "bytes"
    iso.gtrfc.com/length: "32"

    # Push to application namespaces
    iso.gtrfc.com/replicate-to: "app-1,app-2,app-3"
type: Opaque

---
# ❌ INVALID combination - will be rejected
# This will NOT work and will generate a Warning Event
# apiVersion: v1
# kind: Secret
# metadata:
#   name: invalid-secret
#   namespace: default
#   annotations:
#     # ERROR: Cannot use both autogenerate and replicate-from
#     iso.gtrfc.com/autogenerate: "password"
#     iso.gtrfc.com/replicate-from: "other-ns/other-secret"
# type: Opaque

---
# Advanced example: Multi-tier secret distribution
# Production generates -> Staging pulls -> Development pulls from staging
apiVersion: v1
kind: Secret
metadata:
  name: db-master-credentials
  namespace: production
  annotations:
    # Generate database credentials
    iso.gtrfc.com/autogenerate: "db-root-password"
    iso.gtrfc.com/length: "48"
    iso.gtrfc.com/string.specialChars: "true"
    iso.gtrfc.com/string.allowedSpecialChars: "!@#$%^&*"

    # Allow staging to pull
    iso.gtrfc.com/replicatable-from-namespaces: "staging"
type: Opaque
data:
  db-host: cG9zdGdyZXMucHJvZHVjdGlvbi5zdmMuY2x1c3Rlci5sb2NhbA==  # postgres.production.svc.cluster.local
  db-user: cG9zdGdyZXM=  # postgres
  # db-root-password will be auto-generated

---
apiVersion: v1
kind: Secret
metadata:
  name: db-credentials
  namespace: staging
  annotations:
    # Pull from production
    iso.gtrfc.com/replicate-from: "production/db-master-credentials"

    # Also allow development to pull from staging
    iso.gtrfc.com/replicatable-from-namespaces: "development"
type: Opaque

---
apiVersion: v1
kind: Secret
metadata:
  name: db-credentials
  namespace: development
  annotations:
    # Pull from staging (which pulled from production)
    iso.gtrfc.com/replicate-from: "staging/db-credentials"
type: Opaque
