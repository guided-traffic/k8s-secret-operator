# Push-based Replication Example
#
# This example demonstrates push-based replication where a source Secret
# pushes its data to target namespaces.
#
# Behavior:
# - Source automatically creates Secrets in target namespaces
# - Targets automatically sync when source changes
# - If target exists without 'replicated-from' annotation: Skipped (Warning Event)
# - If target exists with matching 'replicated-from': Updated
# - When source is deleted: All pushed Secrets are automatically cleaned up

---
# Source Secret that pushes to multiple namespaces
apiVersion: v1
kind: Secret
metadata:
  name: app-secret
  namespace: production
  annotations:
    # Push this Secret to staging and development namespaces
    iso.gtrfc.com/replicate-to: "staging,development"
type: Opaque
data:
  app-id: YXBwLTEyMzQ1  # app-12345
  app-secret: c2VjcmV0a2V5  # secretkey

---
# Example with single target namespace
apiVersion: v1
kind: Secret
metadata:
  name: database-creds
  namespace: platform
  annotations:
    iso.gtrfc.com/replicate-to: "application"
type: Opaque
data:
  username: ZGJ1c2Vy  # dbuser
  password: ZGJwYXNz  # dbpass

---
# Example combining autogenerate with push replication
# The operator will:
# 1. Generate the password automatically
# 2. Push the Secret (including generated password) to target namespaces
apiVersion: v1
kind: Secret
metadata:
  name: generated-and-pushed
  namespace: security
  annotations:
    # Generate password
    iso.gtrfc.com/autogenerate: "password"
    iso.gtrfc.com/length: "32"
    iso.gtrfc.com/string.specialChars: "true"
    # Push to multiple namespaces
    iso.gtrfc.com/replicate-to: "app-1,app-2,app-3"
type: Opaque
data:
  username: YWRtaW4=  # admin
  # password will be auto-generated and pushed

---
# Pushed Secrets are created automatically with this structure:
# apiVersion: v1
# kind: Secret
# metadata:
#   name: app-secret  # Same name as source
#   namespace: staging  # Target namespace
#   annotations:
#     iso.gtrfc.com/replicated-from: "production/app-secret"
#     iso.gtrfc.com/last-replicated-at: "2025-12-05T10:00:00Z"
# type: Opaque
# data:
#   app-id: YXBwLTEyMzQ1
#   app-secret: c2VjcmV0a2V5
