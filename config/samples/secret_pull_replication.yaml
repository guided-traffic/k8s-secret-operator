# Pull-based Replication Example
#
# This example demonstrates pull-based replication where a target Secret
# pulls data from a source Secret in another namespace.
#
# Requirements:
# - Mutual consent: Both source and target must explicitly allow the replication
# - Source must have 'replicatable-from-namespaces' annotation (allowlist)
# - Target must have 'replicate-from' annotation pointing to source
#
# Behavior:
# - Target automatically syncs when source changes
# - If source is deleted, target keeps last known data (snapshot)

---
# Source Secret in production namespace
apiVersion: v1
kind: Secret
metadata:
  name: db-credentials
  namespace: production
  annotations:
    # Allow staging namespace to replicate from this Secret
    iso.gtrfc.com/replicatable-from-namespaces: "staging"

    # Optional: Generate password automatically
    # iso.gtrfc.com/autogenerate: "password"
    # iso.gtrfc.com/length: "32"
type: Opaque
data:
  username: cHJvZHVzZXI=  # produser
  password: cHJvZHBhc3M=  # prodpass

---
# Target Secret in staging namespace
apiVersion: v1
kind: Secret
metadata:
  name: db-credentials
  namespace: staging
  annotations:
    # Pull data from production/db-credentials
    iso.gtrfc.com/replicate-from: "production/db-credentials"
type: Opaque
# Note: data field is optional - will be populated by operator
# Existing data will be overwritten with replicated data

---
# Example with wildcard patterns
apiVersion: v1
kind: Secret
metadata:
  name: api-key
  namespace: production
  annotations:
    # Allow all namespaces matching pattern
    iso.gtrfc.com/replicatable-from-namespaces: "env-*,namespace-[0-9]*"
type: Opaque
data:
  api-key: c2VjcmV0a2V5  # secretkey

---
# Target pulling from wildcard source
apiVersion: v1
kind: Secret
metadata:
  name: api-key
  namespace: env-staging
  annotations:
    iso.gtrfc.com/replicate-from: "production/api-key"
type: Opaque

---
# Another target pulling from wildcard source
apiVersion: v1
kind: Secret
metadata:
  name: api-key
  namespace: namespace-123
  annotations:
    iso.gtrfc.com/replicate-from: "production/api-key"
type: Opaque

---
# Example with wildcard allowing all namespaces
apiVersion: v1
kind: Secret
metadata:
  name: shared-config
  namespace: config
  annotations:
    # Allow ANY namespace to replicate
    iso.gtrfc.com/replicatable-from-namespaces: "*"
type: Opaque
data:
  config.yaml: |
    ZGF0YWJhc2U6CiAgaG9zdDogbG9jYWxob3N0CiAgcG9ydDogNTQzMg==
